<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <title> Artikel aanmaken</title>
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="dashboard.css" rel="stylesheet">
	<link href="css/bootstrap.icon-large.min.css" rel="stylesheet">
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
    $.get("../sources/sidebar.html", function(data) {
		$("#sidebar_placeholder").replaceWith(data);
	});
	</script>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="hoofdpagina.html">Webshop</a>
        </div>
       
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <div id="sidebar_placeholder"></div>
        </div>
		
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
          <h1 id="ArtikelAanmakenH1" class="page-header">Artikel aanmaken</h1>
          <div class='expendable'></div>
		  
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                 
                  <th class="col-xs-2">Afbeelding</th>
                  <th class="col-xs-2">Naam</th>
                  <th class="col-xs-1">Omschrijving</th>
				  <th class="col-xs-1">Prijs</th>
				 <th></th>
                </tr>
              </thead>
              
              <tbody>
                <tr>
				<form id="artikelAanmaken" accept-charset="utf-8">
                 <td> <input id="Afbeelding" type="file" class="form-control" name="Afbeelding" accept="image/gif, image/jpeg, image/png"></td>
                  <td> <input type="text" class="form-control" id="Naam" name="Naam"/></td>
                  <td><input type="text" class="form-control" id="Omschrijving" name="Omschrijving"/></td>
                  <td><input type="text" class="form-control" id="Prijs" name="Prijs"/></td>
				  <td><button type="button" class="btn btn-success" id="artikelPost">Product aanmaken</button></td>
				  </form>
                </tr>
              </tbody>
            </table>
          </div>
          
              <div class="table-responsive">		  
            <table class="table table-striped" id='voorraad'>
              <thead>
                <tr>
                  <th class="col-xs-1">#ID</th>
                  <th class="col-xs-3">Naam</th>
                  <th class="col-xs-2">Omschrijving</th>
				  <th class="col-xs-1">Prijs</th>
				 <th class="col-xs-1">Wijzigen</th>
				 <th class="col-xs-1">Verwijderen</th>
                </tr>
              </thead>
              <tbody>
              
              </tbody>
            </table>
          </div>
        </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="js/bootstrap.min.js"></script>
    <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
    <script src="assets/js/vendor/holder.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="assets/js/ie10-viewport-bug-workaround.js"></script>
    
    <script>
    $("#logout").click(function(event){
    	window.sessionStorage.setItem("sessionToken", "guest");
    	window.location.href="index.html";
    })
    
    $("#artikelPost").click(function(response){
   // 	var ID = $("#ID").val();
    	var Afbeelding = $("#Afbeelding").val();
    	var Naam = $("#Naam").val();
    	var Omschrijving = $("#Omschrijving").val();
    	var Prijs = $("#Prijs").val();
    	// format voor bedragen (4.10, 9.43 etc)
    	var currRegex = /^\d+(?:\.\d{0,2})$/;    	
    	
    	//controleer of alle in ingevuld en niet groter is dan wat de database toe staat. isNaN gebruikt om te kijken of input wel een nummer is a
  //  	if( isNaN(ID) || ID.length != 4){
   // 		$(".expendable").replaceWith("<div class='alert alert-warning expendable' id='response'>ID moet 4 cijfers bevatten!</div>");
   // 	}
    	if(Naam.length < 1 || Naam.length > 50){
    		$(".expendable").replaceWith("<div class='alert alert-warning expendable' id='response'>Naam moet 1-50 karakters bevatten!</div>");	
    	}
    //	else if(Afbeelding.length < 1){
    //		$(".expendable").replaceWith("<div class='alert alert-warning expendable' id='response'>Categorie moet worden ingevuld!</div>");
    //	}
    	else if (!(currRegex.test(Prijs))){
    		$(".expendable").replaceWith("<div class='alert alert-warning expendable' id='response'>Prijs moet een bedrag zijn met 2 decimalen! Voorbeeld: 15.94</div>");
    	}
    //	else if(isNaN(Aantal) || Aantal.length < 1 || !(Aantal % 1 === 0)){
    //		$(".expendable").replaceWith("<div class='alert alert-warning expendable' id='response'>Aantal moet een heel getal zijn!</div>");
    //	}
    	
    else {
    	$.ajax({
			url: "restservices/producten/",
			success: function(response){
				var data = $("#artikelAanmaken").serialize();
		    	$.post("restservices/producten", data, function(response){
		    		// reset de form voor nieuwe input
   				$("#artikelAanmaken")[0].reset(); 
   				
   				$(".expendable").replaceWith("<div class='alert alert-success expendable' id='response'> <strong>Artikel:</strong> " + response.ID + " " + response.Naam + " is toegevoegd aan de voorraad!</div>");
		    	})
		    	},
   				error: function(response){
   				$(".expendable").replaceWith("<div class='alert alert-danger expendable' id='response'> Er is iets mis gegaan! Artikel is <strong>niet</strong> toegevoegd.</div>");
   			}
    	
    	});
    }
     });
    
	$.ajax({
		url: "restservices/producten/",
		method: "GET",
		beforeSend: function (xhr) {
		var token = window.sessionStorage.getItem("sessionToken");
		xhr.setRequestHeader( 'Authorization', 'Bearer ' + token);
		},
		success: function (voorraad) {
			//vul hele pagina met alle artikelen
			$.each(voorraad, function(i, artikel){ 
		   		$("#voorraad").append("<tr id='"+artikel.ID+"'><td>" + artikel.ID + "</td><td>" + artikel.Naam + "</td><td>" + artikel.Omschrijving 
		   		+ "</td>><td>â‚¬" + artikel.Prijs + "</td>" 
		   		+ "<td><button type='button' class='btn btn-warning' id='alter" + artikel.ID
		   		+ "'>Artikel Wijzigen</button></td><td>" + "<button type='button' class='btn btn-danger' id='delete" 
		   		+ artikel.ID + "'> Artikel Verwijderen</button>" + "</td></tr>");
		   		
		   		$("#alter" + artikel.ID).one("click",function(){ 
		   			//als gebruiker op wijzig artikel klikt, maak van alle gegevens input velden met daarin wel de bijhorende gegevens
		   //			$(this).parents("tr").replaceWith("<tr><form id='updateArtikelForm'>"
		   //			+   "<td><input class='form-control'   type='text' name='ID'        id='" + artikel.ID +"' value='" + artikel.ID + "' readonly></td>" 
		   //			+ 	"<td> <input class='form-control'  type='text' name='Naam'      id='" + artikel.Naam + "' value='"+artikel.Naam+"'></td>"	
		   //			+ 	"<td> <input class='form-control'  type='text' name='Omschrijving'      id='" + artikel.Omschrijving + "' value='"+artikel.Omschrijving+"'></td>"	
		   //			+ 	"<td> <input class='form-control'  type='text' name='Prijs'id='" + artikel.Prijs + "' value='"+artikel.Prijs+"'></td>"	
		   //			+   "<td> <button type='button' class='btn btn-primary' id='wijzigArtikel" + artikel.ID + "'>Wijziging opslaan</button> </td>"
		   //			+   "<td> <button type='button' class='btn btn-info' id='wijzigArtikelAnnuleren" + artikel.ID+ "'>Wijzigen annuleren</button></td>"
		   //			+		"</form></tr>");
		   			
		   		 var trid = $(this).closest('tr').attr('id');
	   		     var replacer = $("<tr>").attr('id', trid);
	   		     
	   		     var formulier = $("<form id='updateForm"+trid+"'>");
	   		     formulier.append($("<td>").append($("<input value='"+trid+"' readonly name='ID'/>"))); //inputs vullen en deze rij herhalen
	   		     formulier.append($("<td>").append($("<input placeholder='Naam' name='Naam' required='required' type='text'/>"))); //inputs vullen en deze rij herhalen
	   		     formulier.append($("<td>").append($("<input placeholder='Omschrijving' name='Omschrijving' type='text' required='required'/>"))); //inputs vullen en deze rij herhalen
	   		     formulier.append($("<td>").append($("<input placeholder='Prijs' type='text' required='required' name='Prijs'/>"))); //inputs vullen en deze rij herhalen
	   		     formulier.append($("<td>").append($("<button type='button' class='btn btn-primary' id='wijzigArtikel" + artikel.ID + "'>Wijziging opslaan</button>"))); //inputs vullen en deze rij herhalen
	   		     formulier.append($("<td>").append($("<button type='button' class='btn btn-info' id='wijzigArtikelAnnuleren" + artikel.ID+ "'>Wijzigen annuleren</button>"))); //inputs vullen en deze rij herhalen

	   		     formulier.appendTo(replacer);
	   		     $(this).parents("tr").replaceWith(replacer);	
		   			$("#wijzigArtikel" + artikel.ID).click(function(){
		   			
		   				/* var uri = "/restservices/voorraad/" + artikel.ID + "/" + artikel.Maat + "/" + artikel.Kleur;
		   	   			$.ajax(uri, {
		   	   				method: "PUT",
		   	   				data: $("#updateArtikelForm").serialize(),
		   	   			beforeSend: function (xhr) {
		   					var token = window.sessionStorage.getItem("sessionToken");
		   					xhr.setRequestHeader( 'Authorization', 'Bearer ' + token);
		   					},
		   	   			success: function(response){	
		   	   				$(".expendable").replaceWith("<div class='alert alert-success' id='response'> <strong>Artikel:</strong> " + artikel.ID + " " + artikel.Naam + " is gewijzigd!</div>");
		   	   				},
		   	   			error: function(response){
		   	   				$(".expendable").replaceWith("<div class='alert alert-danger' id='response'> Er is iets mis gegaan! Artikel is <strong>niet</strong> gewijzigd.</div>");
		   	   			}
		   	   			})	*/
		   	   	//functie hierboven in de comment werkt niet door een '403 forbidden' error, nu krijgt de gebruiker een bericht van de browser  	
		   	   	     var trid = $(this).closest('tr').attr('id');
     var uri = "restservices/producten/" + trid;
		   	   	   $.ajax(uri, {
        type: "PUT",
        data: $("updateForm" + trid).serialize(),
     //    beforeSend: function (xhr) {
      //       var token = window.sessionStorage.getItem("sessionToken");
       //      xhr.setRequestHeader( 'Authorization', 'Bearer ' + token);
        //     },
        success: function(response){
        	$("body").load("productbeheer.html")	
				
				function notification(){
				$(".expendable").replaceWith("<div class='alert alert-success' id='response'> <strong>Artikel:</strong> " + artikel.ID + " " + artikel.Naam + " is aangepast!</div>");
				} 
			// laat bericht zien,  0.3 seconde na de pagina refresh
				setTimeout(notification, 300); 
				},
				
				error: function(response){
				$(".expendable").replaceWith("<div class='alert alert-danger' id='response'> Er is iets mis gegaan! Artikel is <strong>niet</strong> aangepast.</div>");
			}
        
        });
		   	   	
		   				//alert("Deze functie werkt nog niet. Onze excuses."); 
		   	   		})
		   	   		
		   	   		$("#wijzigArtikelAnnuleren"+artikel.ID).click(function(){
		   	   	// refresh pagina
		   	   		location.reload();	
		   	   		
		   	   		})
		   	})
		   		
	
		   	
		   	
		   	
		   	
		   		$("#delete" + artikel.ID).one("click",function(){   
		   			var uri = ("restservices/producten/") + artikel.ID;
		   			
		   		//vraag gebruiker om op OK of annuleren te drukken
		   		  var r = confirm("Weet je zeker dat je dit artikel wilt verwijderen?"); 
		   		  
		   		//als gebruiker OK kiest, verwijder artikel. hiermee worden ook alle verkoopregels verwijderd die gelinkt zijn aan dit artikel(zie artikelDAO.java)
		   		  if (r == true){ 
		   			$.ajax(uri, {
		   				method: "DELETE",
		   	//			beforeSend: function (xhr) {
		   	//				var token = window.sessionStorage.getItem("sessionToken");
		   	//				xhr.setRequestHeader( 'Authorization', 'Bearer ' + token);
		   	//				},
		   				success: function(response){	
		   				// refresh pagina
		   				$("body").load("productbeheer.html")	
		   				
		   				function notification(){
		   				$(".expendable").replaceWith("<div class='alert alert-success' id='response'> <strong>Artikel:</strong> " + artikel.ID + " " + artikel.Naam + " is verwijderd uit de voorraad!</div>");
		   				} 
		   			// laat bericht zien,  0.3 seconde na de pagina refresh
		   				setTimeout(notification, 300); 
		   				},
		   				
		   				error: function(response){
		   				$(".expendable").replaceWith("<div class='alert alert-danger' id='response'> Er is iets mis gegaan! Artikel is <strong>niet</strong> verwijderd.</div>");
		   			}
		   			})
		   		  }
		   		  else {
		   		  }
		   			
		   		})
		})
		}
		});
    
    
    
    
    </script>
  </body>
</html>
